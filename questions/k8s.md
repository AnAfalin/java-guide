#### [Оглавление](../README.md)

# Kubernetes

+ [Основы Kubernetes](#основы-kubernetes)
+ [Пространства имен](#пространства-имен)

_______________________________________________________________________________________________________________________
<span style="display: inline-block; float: right">[содержание](#kubernetes)</span>

# Основы Kubernetes

Слово “Kubernetes” происходит от древнегреческого κυβερνήτης, что означает капитан, рулевой, пилот; тот, кто управляет.
В сокращении “K8S” цифра 8 - это восемь букв между K и S. Это платформа с открытым исходным кодом для развертывания,
масштабирования, управления и контроля контейнеризованных приложений либо сервисов

Kubernetes делает следующее:
+ Управляет и запускает контейнеры
+ Балансирует сетевой трафик между узлами кластера Kubernetes и количеством реплик контейнеров
+ Осуществляет контроль состояния, автоматические развертывания и откаты реплик контейнеров внутри узлов кластера Kubernetes
+ Осуществляет распределение нагрузки между узлами кластера Kubernetes
+ Предоставляет автоматическое монтирование систем хранения для контейнеров
+ Предоставляет декларативный API и CLI для управления
+ И еще множество полезных, и не очень, модулей и сервисов, которые можно развернуть для управления автоматизацией, инфраструктурой и контейнерами

Kubernetes предоставляет:
+ Быструю и автоматическую масштабируемость. При росте нагрузки можно быстро добавить необходимые узлы приложения,
  а также быстро их вывести, чтобы не тратить драгоценные ресурсы
+ Гибкий подход к эксплуатации. Мы можем быстро и легко построить структуру приложения, так как вся структура описывается
  в конфигурационных файлах - манифестах
+ Гибкий подход в управлении. Kubernetes не потребует перестройки инфраструктуры и прочего, если вы захотели провести
  тестирование, внедрить новый сервис или сделать деплой по методологии blue-green
+ Универсальность. С помощью манифестов легко переехать, если вы захотели поменять провайдера или переезжали в свой
  собственный кластер
+ Низкий порог вхождения в использование. Kubernetes довольно легок в освоении манифестов, потому что большую часть
  работы он делает за вас.

Сам кластер K8S состоит из рабочих узлов. В узлах или нодах (___Nodes, Worker nodes___), помимо контейнеров компонентов
самого кластера, размещаются контейнеры наших проектов и сервисов().

Worker nodes состоит из компонентов:
+ __kubelet__ - сервис или агент, который контролирует запуск компонентов (контейнеров) кластера
+ __kube-proxy__ - конфигурирует правила сети на узлах

Плоскость управления (Master nodes) управляет рабочими узлами и подами в кластере. Там располагаются компоненты, которые
управляют узлами кластера и предоставляют доступ к API.

Control plane состоит из компонентов:
+ __kube-apiserver__ - предоставляет API кубера
+ __etcd__ - распределенное key-value хранилище для всех данных кластера. Необязательно располагается внутри мастера,
  может стоять как отдельный кластер
+ __kube-scheduler__ - планирует размещение подов на узлах кластера
+ __kube-controller-manager__ - запускает контроллеры
+ __kubelet__ - сервис или агент, который контролирует запуск основных компонентов (контейнеров) кластер

##№ Виды контроллеров

__Deployments__ - контроллер, который управляет состоянием развертывания подов, которое описывается в манифесте,
следит за удалением и созданием экземпляров подов. Управляет контроллерами ReplicaSet.

__ReplicaSet__ - гарантирует, что определенное количество экземпляров подов всегда будет запущено в кластере.

__StatefulSets__ - так же как и Deployments, управляет развертыванием и масштабированием набора подов, но сохраняет
набор идентификаторов и состояние для каждого пода.

__DaemonSet__ - гарантирует, что на каждом узле кластера будет присутствовать экземпляр пода.

__Jobs__ - создает определенное количество подов и смотрит, пока они успешно не завершат работу. Если под завершился
с ошибкой, повторяет создание, которое мы описали определенное количество раз. Если под успешно отработал, записывает
это в свой журнал.

__CronJob__ - запускает контроллеры Jobs по определенному расписанию.
_______________________________________________________________________________________________________________________
<span style="display: inline-block; float: right">[содержание](#kubernetes)</span>

### Пространства имен

+ __default__ — пространство имён по умолчанию для объектов без какого-либо другого пространства имён
+ __kube-system__ — пространство имён для объектов, созданных Kubernetes. Там размещаются системные поды кластера
+ __kube-public__ — создаваемое автоматически пространство имён, которое доступно для чтения всем пользователям (включая
  также неаутентифицированных пользователей)

В файле `.yaml` создаваемого объекта Kubernetes необходимо указать значения для следующих полей:

+ `apiVersion` — используемая для создания объекта версия API Kubernetes. Стоит отметить, что из версии к версии версии
  api могут меняться
+ `kind` — тип создаваемого объекта
+ `metadata` — данные, позволяющие идентифицировать объект (name, UID и необязательное поле namespace)
+ `spec` — требуемое состояние объекта

__Метка__ – это произвольная пара «ключ-значение», присоединяемая к ресурсу, которая затем используется при отборе ресурсов с
помощью селекторов меток (ресурсы фильтруются на основе того, включают они метку, указанную в селекторе, или нет). Ресурс
может иметь несколько меток, если ключи этих меток уникальны в пределах данного ресурса. Метки обычно прикрепляются к
ресурсам при их создании, но можно также добавлять дополнительные метки или даже изменять значения существующих меток
позже без необходимости повторного создания ресурса.

__Сервис (Service)__ в Kubernetes — это абстрактный объект, который определяет логический набор подов и политику доступа
к ним. Сервисы создают слабую связь между подами, которые от них зависят. Сервис создаётся в формате YAML (рекомендуемый
формат) или JSON, как и все остальные объекты в Kubernetes. Как правило, набор подов для сервиса определяется селектором
лейблов (label selector) — ниже будет описано, в каких случаях может понадобиться сервис без указания селектора (selector)
в его спецификации.

Хотя у каждого пода есть уникальный IP-адрес, эти IP-адреса не доступны за пределами кластера без использования сервиса.
Сервисы позволяют приложениям принимать трафик. Сервисы могут быть по-разному открыты, в зависимости от значения поля type,
указанного в спецификации сервиса:

+ __ClusterIP__ (по умолчанию) — открывает доступ к сервису по внутреннему IP-адресу в кластере. Этот тип делает сервис
  доступным только внутри кластера;
+ __NodePort__ — открывает сервис на том же порту каждого выбранного узла в кластере с помощью NAT. Делает сервис
  доступным вне кластера через <NodeIP>:<NodePort>. Является надмножеством ClusterIP.
+ __LoadBalancer__ — создает внешний балансировщик нагрузки в текущем облаке (если это поддерживается) и назначает
  фиксированный внешний IP-адрес для сервиса. Является надмножеством NodePort.
+ __ExternalName__ — открывает доступ к сервису по содержимому поля externalName (например, foo.bar.example.com), возвращая
  запись CNAME с его значением. При этом прокси не используется. Для этого типа требуется версия kube-dns 1.7+ или
  CoreDNS 0.0.8+.